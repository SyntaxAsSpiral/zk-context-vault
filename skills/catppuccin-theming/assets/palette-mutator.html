<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZK Palette Mutator ðŸŽ¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Recursive', 'SF Mono', monospace;
            background: #1e1e2e;
            color: #cdd6f4;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #cba6f7;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            color: #a6adc8;
            font-size: 1.1rem;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 30px;
            align-items: start;
        }

        .controls-panel {
            background: #313244;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #45475a;
        }

        .palette-display {
            background: #313244;
            border-radius: 12px;
            padding: 30px;
            border: 1px solid #45475a;
        }

        .export-panel {
            background: #313244;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #45475a;
        }

        .section-title {
            color: #b4befe;
            font-size: 1.2rem;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .file-input {
            width: 100%;
            padding: 10px;
            background: #45475a;
            border: 1px solid #585b70;
            border-radius: 8px;
            color: #cdd6f4;
            margin-bottom: 20px;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-label {
            display: block;
            color: #bac2de;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #45475a;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #89b4fa;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #89b4fa;
            cursor: pointer;
            border: none;
        }

        .value-display {
            color: #f9e2af;
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .color-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 50px;
            padding: 10px;
        }

        .color-swatch {
            aspect-ratio: 1;
            border-radius: 12px;
            border: 2px solid #45475a;
            position: relative;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 30px;
        }

        .color-swatch:hover {
            transform: scale(1.05);
            border-color: #89b4fa;
        }

        .color-info {
            position: absolute;
            bottom: -28px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 0.75rem;
            color: #a6adc8;
            font-weight: 500;
            background: rgba(30, 30, 46, 0.8);
            padding: 2px 4px;
            border-radius: 4px;
        }

        .palette-preview {
            background: #45475a;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .preview-element {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 6px;
        }

        .btn {
            width: 100%;
            padding: 12px;
            background: #89b4fa;
            color: #1e1e2e;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 10px;
            transition: background 0.2s ease;
        }

        .btn:hover {
            background: #74c7ec;
        }

        .btn-secondary {
            background: #585b70;
            color: #cdd6f4;
        }

        .btn-secondary:hover {
            background: #6c7086;
        }

        .export-textarea {
            width: 100%;
            height: 200px;
            background: #45475a;
            border: 1px solid #585b70;
            border-radius: 8px;
            color: #cdd6f4;
            padding: 10px;
            font-family: 'SF Mono', monospace;
            font-size: 0.8rem;
            resize: vertical;
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .preset-btn {
            padding: 8px;
            background: #45475a;
            color: #cdd6f4;
            border: 1px solid #585b70;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .preset-btn:hover {
            background: #585b70;
            border-color: #6c7086;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ZK Palette Mutator ðŸŽ¨</h1>
            <p>Load, mutate, and export beautiful color palettes</p>
        </div>

        <div class="main-grid">
            <!-- Controls Panel -->
            <div class="controls-panel">
                <div class="section-title">Load Palette</div>
                <input type="file" class="file-input" id="fileInput" accept=".json">
                
                <div class="preset-buttons">
                    <button class="preset-btn" onclick="loadPreset('mocha')">Mocha</button>
                    <button class="preset-btn" onclick="loadPreset('frappe')">FrappÃ©</button>
                    <button class="preset-btn" onclick="loadPreset('rose')">Rose</button>
                    <button class="preset-btn" onclick="loadPreset('sage')">Sage</button>
                </div>

                <div class="section-title">Mutations</div>
                
                <div class="control-group">
                    <label class="control-label">Hue Shift</label>
                    <input type="range" class="slider" id="hueShift" min="-180" max="180" value="0">
                    <div class="value-display" id="hueValue">0Â°</div>
                </div>

                <div class="control-group">
                    <label class="control-label">Saturation</label>
                    <input type="range" class="slider" id="saturation" min="0" max="200" value="100">
                    <div class="value-display" id="satValue">100%</div>
                </div>

                <div class="control-group">
                    <label class="control-label">Lightness</label>
                    <input type="range" class="slider" id="lightness" min="0" max="200" value="100">
                    <div class="value-display" id="lightValue">100%</div>
                </div>

                <div class="control-group">
                    <label class="control-label">Contrast</label>
                    <input type="range" class="slider" id="contrast" min="50" max="150" value="100">
                    <div class="value-display" id="contrastValue">100%</div>
                </div>

                <button class="btn" onclick="resetMutations()">Reset</button>
                <button class="btn btn-secondary" onclick="randomMutation()">Random</button>
            </div>

            <!-- Palette Display -->
            <div class="palette-display">
                <div class="section-title">Palette Preview</div>
                <div class="color-grid" id="colorGrid">
                    <!-- Colors will be populated here -->
                </div>

                <div class="section-title">Live Preview</div>
                <div class="palette-preview" id="palettePreview">
                    <div class="preview-element" style="background: var(--bg-primary); color: var(--text-primary);">
                        Primary background with text
                    </div>
                    <div class="preview-element" style="background: var(--accent-blue); color: var(--bg-primary);">
                        Blue accent button
                    </div>
                    <div class="preview-element" style="background: var(--accent-green); color: var(--bg-primary);">
                        Success state
                    </div>
                    <div class="preview-element" style="background: var(--accent-red); color: var(--bg-primary);">
                        Error state
                    </div>
                </div>
            </div>

            <!-- Export Panel -->
            <div class="export-panel">
                <div class="section-title">Export</div>
                
                <button class="btn" onclick="exportCSS()">CSS Variables</button>
                <button class="btn" onclick="exportJSON()">JSON Palette</button>
                <button class="btn" onclick="exportTerminal()">Terminal Theme</button>
                
                <div class="section-title" style="margin-top: 20px;">Output</div>
                <textarea class="export-textarea" id="exportOutput" placeholder="Exported code will appear here..."></textarea>
                
                <button class="btn btn-secondary" onclick="copyToClipboard()">Copy to Clipboard</button>
            </div>
        </div>
    </div>

    <script>
        let currentPalette = null;
        let originalPalette = null;

        // Preset palettes
        const presets = {
            mocha: {
                name: "Catppuccin Mocha",
                color: ["#1e1e2e", "#f38ba8", "#a6e3a1", "#f9e2af", "#89b4fa", "#cba6f7", "#94e2d5", "#cdd6f4", "#45475a", "#fab387", "#a6e3a1", "#f9e2af", "#74c7ec", "#f5c2e7", "#94e2d5", "#b4befe"],
                foreground: "#cdd6f4",
                background: "#1e1e2e"
            },
            frappe: {
                name: "Catppuccin FrappÃ©", 
                color: ["#303446", "#e78284", "#a6d189", "#e5c890", "#8caaee", "#ca9ee6", "#81c8be", "#c6d0f5", "#414559", "#ef9f76", "#a6d189", "#e5c890", "#85c1dc", "#f4b8e4", "#99d1db", "#babbf1"],
                foreground: "#c6d0f5",
                background: "#303446"
            },
            rose: {
                name: "ZK Rose",
                color: ["#1b1323", "#f38ba8", "#a6e3a1", "#f9e2af", "#b4befe", "#cba6f7", "#94e2d5", "#e7def1", "#2b2034", "#eba0ac", "#c9f3ce", "#ffd1b5", "#c8d2ff", "#f5c2e7", "#a6ede0", "#f6ecff"],
                foreground: "#eadff2",
                background: "#1a1320"
            },
            sage: {
                name: "ZK Sage",
                color: ["#2a3330", "#4fae8a", "#8fd2b4", "#fab387", "#79c8a9", "#a5e6cf", "#5dbb9a", "#cfe0d6", "#3a4541", "#67b894", "#9bd9b2", "#ffd1b5", "#8fd2b4", "#d6f1e3", "#74c6a4", "#dfe8e2"],
                foreground: "#dfe8e2",
                background: "#1f2824"
            }
        };

        // Color manipulation functions
        function hexToHsl(hex) {
            const r = parseInt(hex.slice(1, 3), 16) / 255;
            const g = parseInt(hex.slice(3, 5), 16) / 255;
            const b = parseInt(hex.slice(5, 7), 16) / 255;

            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;

            if (max === min) {
                h = s = 0;
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch (max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h /= 6;
            }

            return [h * 360, s * 100, l * 100];
        }

        function hslToHex(h, s, l) {
            h = h / 360;
            s = s / 100;
            l = l / 100;

            const hue2rgb = (p, q, t) => {
                if (t < 0) t += 1;
                if (t > 1) t -= 1;
                if (t < 1/6) return p + (q - p) * 6 * t;
                if (t < 1/2) return q;
                if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                return p;
            };

            let r, g, b;
            if (s === 0) {
                r = g = b = l;
            } else {
                const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                const p = 2 * l - q;
                r = hue2rgb(p, q, h + 1/3);
                g = hue2rgb(p, q, h);
                b = hue2rgb(p, q, h - 1/3);
            }

            const toHex = (c) => {
                const hex = Math.round(c * 255).toString(16);
                return hex.length === 1 ? '0' + hex : hex;
            };

            return `#${toHex(r)}${toHex(g)}${toHex(b)}`;
        }

        function mutateColor(hex, hueShift, satMult, lightMult, contrastMult) {
            let [h, s, l] = hexToHsl(hex);
            
            h = (h + hueShift) % 360;
            if (h < 0) h += 360;
            
            s = Math.max(0, Math.min(100, s * satMult));
            l = Math.max(0, Math.min(100, l * lightMult));
            
            // Apply contrast (move away from middle gray)
            l = l + (l - 50) * (contrastMult - 1);
            l = Math.max(0, Math.min(100, l));
            
            return hslToHex(h, s, l);
        }

        function loadPreset(presetName) {
            originalPalette = JSON.parse(JSON.stringify(presets[presetName]));
            currentPalette = JSON.parse(JSON.stringify(presets[presetName]));
            updateDisplay();
        }

        function updateDisplay() {
            if (!currentPalette) return;

            const colorGrid = document.getElementById('colorGrid');
            colorGrid.innerHTML = '';

            currentPalette.color.forEach((color, index) => {
                const swatch = document.createElement('div');
                swatch.className = 'color-swatch';
                swatch.style.backgroundColor = color;
                swatch.innerHTML = `<div class="color-info">${color}</div>`;
                colorGrid.appendChild(swatch);
            });

            // Update CSS variables for preview
            const root = document.documentElement;
            root.style.setProperty('--bg-primary', currentPalette.background);
            root.style.setProperty('--text-primary', currentPalette.foreground);
            root.style.setProperty('--accent-blue', currentPalette.color[4]);
            root.style.setProperty('--accent-green', currentPalette.color[2]);
            root.style.setProperty('--accent-red', currentPalette.color[1]);
        }

        function applyMutations() {
            if (!originalPalette) return;

            const hueShift = parseFloat(document.getElementById('hueShift').value);
            const saturation = parseFloat(document.getElementById('saturation').value) / 100;
            const lightness = parseFloat(document.getElementById('lightness').value) / 100;
            const contrast = parseFloat(document.getElementById('contrast').value) / 100;

            currentPalette = JSON.parse(JSON.stringify(originalPalette));
            
            currentPalette.color = currentPalette.color.map(color => 
                mutateColor(color, hueShift, saturation, lightness, contrast)
            );
            
            currentPalette.foreground = mutateColor(currentPalette.foreground, hueShift, saturation, lightness, contrast);
            currentPalette.background = mutateColor(currentPalette.background, hueShift, saturation, lightness, contrast);

            updateDisplay();
        }

        function resetMutations() {
            document.getElementById('hueShift').value = 0;
            document.getElementById('saturation').value = 100;
            document.getElementById('lightness').value = 100;
            document.getElementById('contrast').value = 100;
            updateValueDisplays();
            applyMutations();
        }

        function randomMutation() {
            document.getElementById('hueShift').value = Math.random() * 360 - 180;
            document.getElementById('saturation').value = Math.random() * 100 + 50;
            document.getElementById('lightness').value = Math.random() * 100 + 50;
            document.getElementById('contrast').value = Math.random() * 50 + 75;
            updateValueDisplays();
            applyMutations();
        }

        function updateValueDisplays() {
            document.getElementById('hueValue').textContent = document.getElementById('hueShift').value + 'Â°';
            document.getElementById('satValue').textContent = document.getElementById('saturation').value + '%';
            document.getElementById('lightValue').textContent = document.getElementById('lightness').value + '%';
            document.getElementById('contrastValue').textContent = document.getElementById('contrast').value + '%';
        }

        function exportCSS() {
            if (!currentPalette) return;
            
            let css = ':root {\n';
            css += `  --ctp-background: ${currentPalette.background};\n`;
            css += `  --ctp-foreground: ${currentPalette.foreground};\n`;
            
            const colorNames = ['base', 'red', 'green', 'yellow', 'blue', 'mauve', 'teal', 'text', 'surface', 'peach', 'green-bright', 'yellow-bright', 'sapphire', 'pink', 'teal-bright', 'lavender'];
            
            currentPalette.color.forEach((color, index) => {
                css += `  --ctp-${colorNames[index] || `color-${index}`}: ${color};\n`;
            });
            
            css += '}';
            
            document.getElementById('exportOutput').value = css;
        }

        function exportJSON() {
            if (!currentPalette) return;
            document.getElementById('exportOutput').value = JSON.stringify(currentPalette, null, 2);
        }

        function exportTerminal() {
            if (!currentPalette) return;
            
            const terminalConfig = {
                name: currentPalette.name + ' (Mutated)',
                color: currentPalette.color,
                foreground: currentPalette.foreground,
                background: currentPalette.background
            };
            
            document.getElementById('exportOutput').value = JSON.stringify(terminalConfig, null, 2);
        }

        function copyToClipboard() {
            const output = document.getElementById('exportOutput');
            output.select();
            document.execCommand('copy');
        }

        // Event listeners
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const palette = JSON.parse(e.target.result);
                        originalPalette = palette;
                        currentPalette = JSON.parse(JSON.stringify(palette));
                        updateDisplay();
                    } catch (error) {
                        alert('Invalid JSON file');
                    }
                };
                reader.readAsText(file);
            }
        });

        // Slider event listeners
        ['hueShift', 'saturation', 'lightness', 'contrast'].forEach(id => {
            document.getElementById(id).addEventListener('input', function() {
                updateValueDisplays();
                applyMutations();
            });
        });

        // Initialize
        loadPreset('mocha');
        updateValueDisplays();
    </script>
</body>
</html>